angular.module("templates",[]).run(["$templateCache",function(t){t.put("404/404.html",'<main class="sm text-center" style=color:#f5f5f5;><nav><a href=#/decks>My Decks</a><div class=pull-right><ng-include src="\'auth/auth.html\'"></ng-include></div></nav><h1>404</h1><span>~(=^..^)</span></main>'),t.put("auth/auth.html",'<div ng-controller="AuthController as vm"><button ng-click=vm.login() ng-if=!vm.isLoggedIn() ng-disabled=vm.isLoggingIn><span ng-if=vm.isLoggingIn>Logging In <span text-spinner></span></span> <span ng-if=!vm.isLoggingIn>Login</span></button> <button ng-click=vm.logout() ng-if=vm.isLoggedIn()>Logout</button></div>'),t.put("cardGroup/cardGroup.html",'<div ng-controller="CardGroupController as vm"><header class="flex padding-h-lte-sm" ng-if=!vm.isEditing><button class="header-button text-left-gte-sm" ng-click="vm.showToolbar = !vm.showToolbar"><div>{{::vm.cardGroup.name}} <span class=icon ng-if="vm.cardGroup.cards.length > 0">{{vm.showToolbar ? "7" : "4"}}</span></div><div class="small light">{{::vm.cardGroup.count}} cards <span class=price ng-if=::vm.cardGroup.usd>&#8226; ${{vm.cardGroup.usd | number: 2}}</span></div></button><span class=header-button ng-if=vm.canEdit ng-click=vm.startEditing()>Edit</span></header><header class="flex padding-h-lte-sm" ng-if=vm.isEditing><button class="header-button text-left-gte-sm" ng-click=vm.applyChanges()><div>{{::vm.cardGroup.name}} <span class=icon ng-if="vm.cardGroup.cards.length > 0">{{vm.showToolbar ? "7" : "4"}}</span></div><div class="small light">{{::vm.cardGroup.count}} cards <span class=price ng-if=::vm.cardGroup.usd>&#8226; ${{vm.cardGroup.usd | number: 2}}</span></div></button><span class=tab>Edit</span></header><div class=radio-group ng-if="vm.cardGroup.cards.length > 0 && !vm.isEditing && vm.showToolbar"><label><input type=radio ng-model=vm.view value=group-by-type ng-click="vm.showToolbar = false"> Card Type</label> <label><input type=radio ng-model=vm.view value=group-by-color ng-click="vm.showToolbar = false"> Color</label> <label><input type=radio ng-model=vm.view value=group-by-cmc ng-click="vm.showToolbar = false"> Converted Mana Cost</label> <label><input type=radio ng-model=vm.view value=group-by-name ng-click="vm.showToolbar = false"> Name</label> <label><input type=radio ng-model=vm.view value=group-by-price ng-click="vm.showToolbar = false"> Price</label></div><div class="alert alert-danger margin" ng-if="vm.cardGroup.failedCards.length > 0"><p class=alert-title>Unknown Cards</p><span ng-repeat="card in vm.cardGroup.failedCards track by $index">{{card}}<br></span></div><div ng-if="!vm.isEditing && vm.cardGroup.cards.length > 0"><directive-container directive=vm.view cardgroup=vm.cardGroup></directive-container></div><form name=vm.form class=margin ng-if=vm.isEditing><textarea class="form-control has-bottom-buttons" placeholder="4x Island" ng-model=vm.cardsBlob ng-model-options="{updateOn: \'blur\'}" msd-elastic></textarea><div class=bottom-buttons><button class="btn btn-default" type=button ng-click=vm.applyChanges()>Apply Changes</button><button class="btn btn-default" type=button ng-click=vm.discardChanges()>Discard Changes</button></div></form></div>'),t.put("cardSet/groupBy1.html",'<div class="flex-gte-sm margin" style=margin-bottom:0;><div ng-repeat="column in columns"><div class=card-group ng-repeat="row in ::column"><p class="large capitalize" ng-if=::row.name>{{::row.name}} <span class=light>&#8226; {{::row.numberOfCards}}</span></p><p><span ng-repeat="card in ::row.cards"><span class="quantity light">{{::card.quantity}}</span> <a href=# class=name card-preview=card.definition.imageUri lightbox=card.definition.imageUri>{{::card.definition.name}}</a> <span class="price small light">{{::card.usd | number: 2}}</span><br></span></p></div></div></div>'),t.put("cardSet/groupBy2.html",'<div class="flex-gte-sm margin"><div ng-repeat="column in columns"><div class=card-group ng-repeat="row in ::column"><span ng-repeat="card in ::row.cards"><span class="quantity light">{{::card.quantity}}</span> <a class=name href=# card-preview=card.definition.imageUri lightbox=card.definition.imageUri>{{::card.definition.name}}</a> <span class="price small light">{{::card.usd | number: 2}}</span><br></span></div></div></div>'),t.put("deck/deck.html",'<main ng-controller="DeckController as vm" class="{{vm.showPrices ? \'show-prices\' : \'hide-prices\'}}"><nav><a href=#/decks>My Decks</a><div class=pull-right><ng-include src="\'auth/auth.html\'"></ng-include></div></nav><spinner class=light ng-if=!vm.deck></spinner><div ng-if=vm.deck><section><header class=deck-info><div class=deck-name ng-if=!vm.canEdit>{{vm.deck.name}}</div><input class="form-control deck-name-input" ng-model=vm.deck.name ng-model-options="{updateOn: \'default blur\', debounce: {default: 2000, blur: 0}}" ng-change=vm.save() ng-if=vm.canEdit><div class="flex flex-padding"><button class="btn btn-default margin-top" ng-click=vm.togglePrices()>{{vm.showPrices ? "Hide Prices" : "Show Prices"}} <span text-spinner ng-if="vm.showPricesSpinner && vm.showPrices"></span></button> <button class="btn btn-default margin-top" ng-click=vm.delete() ng-if="vm.canEdit && vm.deck.id" ng-disabled=vm.isDeleting><span ng-if=!vm.isDeleting>Delete this Deck</span> <span ng-if=vm.isDeleting>Deleting <span text-spinner></span></span></button></div></header></section><div class=flex-gte-md><section class=flex-2><div ng-repeat="cardGroup in ::vm.deck.cardGroups"><card-group group=cardGroup can-edit=vm.canEdit is-editing="{{::$index === 0 && vm.deck.id === undefined}}"></card-group></div></section><section class=border-left-gte-md><header class=padding>Notes</header><div ng-if="!vm.canEdit && vm.deck.tags.length > 0"><div class=tags><span class=badge ng-repeat="tag in vm.deck.tags">{{tag}}</span></div><hr class=dashed></div><div class=tag-input ng-if=vm.canEdit><input type=text class="tags transparent" placeholder=tags ng-model=vm.deck.tags ng-model-options="{updateOn: \'default blur\', debounce: {default: 2000, blur: 0}}" ng-list ng-change=vm.save()><hr class=dashed><div><span class=badge ng-repeat="tag in vm.deck.tags track by $index">{{tag}}</span></div></div><textarea class=transparent ng-model=vm.deck.notes ng-model-options="{updateOn: \'default blur\', debounce: {default: 2000, blur: 0}}" ng-change=vm.save() ng-disabled=!vm.canEdit allow-tabs msd-elastic></textarea><header class=padding>Stats</header><stats cards=vm.deck.cardGroups[0].cards ng-if="vm.deck.cardGroups[0].cards.length > 0"></stats></section></div></div></main>'),t.put("decks/decks.html",'<main class=sm ng-controller="DecksController as vm"><nav><div class=select><div class=select-label>{{vm.currentTag || "All"}}<span class=spacer></span><span class=icon style=position:absolute;right:15px; ng-show="vm.tags.length > 0">4</span></div><select ng-model=::vm.currentTag ng-change=::vm.filterDecks() ng-if="vm.tags.length > 0"><option value>- All -</option><option value=Untagged>- Untagged -</option><option ng-repeat="tag in vm.tags | orderBy: \'toString()\'" value={{::tag}}>{{::tag}}&nbsp;&nbsp;</option></select></div><div class=pull-right><ng-include src="\'auth/auth.html\'"></ng-include></div></nav><div class=list-group><a class=list-group-item href=#/decks/new><strong>+</strong> Build a New Deck</a> <a class=list-group-item href=#/decks/{{::deck.id}} ng-repeat="deck in vm.visibleDecks">{{::deck.name}} <span class="badge pull-right" ng-repeat="tag in ::deck.tags track by $index">{{::tag}}</span></a></div><spinner class=light ng-if=vm.timeout></spinner></main>'),t.put("spinner/spinner.html",'<div class=sk-fading-circle><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div>'),t.put("statGroup/statGroup.html",'<div class=stat-group ng-if="group.stats.length > 0"><p class="large capitalize">{{::group.name}}</p><div class=stat-group-row ng-repeat="stat in group.stats"><span class=name>{{::stat.name}}</span> <span class=bar>{{::"X".repeat(stat.value)}}</span> <span class=light ng-if="stat.value > 0">{{::stat.value}}</span></div></div>'),t.put("stats/statsView.html",'<div class=margin ng-controller="StatsController as vm"><stat-group group=vm.statGroups[0]></stat-group></div>')}]);var app;!function(t){angular.module("app",["templates","ngRoute","ngLocationUpdate","satellizer","monospaced.elastic"])}(app||(app={}));var app;!function(t){angular.module("app").constant("config",appConfig),angular.module("app").constant("CardDefinitions",cardsCSV.split("\n").slice(1).reduce(function(t,e){var n=e.split("\t"),r={name:n[0],primaryType:n[1],cmc:Number(n[2]),color:n[3],imageUri:n[4]};return t[r.name.toLowerCase()]=r,t},{})),angular.module("app").config(["$authProvider","config",function(t,e){t.google({clientId:e.authClients.google.clientId,url:e.authClients.google.authUrl})}]),angular.module("app").config(["SatellizerConfig","config",function(t,e){t.tokenPrefix=e.localStorage.prefix}]),angular.module("app").run(["config","$http","$q","$auth",function(t,e,n,r){var i=localStorage.getItem("api-key");i&&(e.defaults.headers.common["Api-Key"]=i,r.isAuthenticated=function(){return!0},r.logout=function(){return n.reject()},r.authenticate=function(){return n.reject()})}]);var e=void 0,n=function(){void 0===e?e=new Date:(new Date).getTime()-e.getTime()<100?(appConfig.enableHover=!0,document.body.removeEventListener("mouseover",n),document.body.addEventListener("touchstart",r)):e=new Date},r=function(){appConfig.enableHover=!1,document.body.removeEventListener("touchstart",r),document.body.addEventListener("mouseover",n)};r()}(app||(app={}));var app;!function(t){var e=function(){function t(t){t.when("/decks/:id",{templateUrl:"deck/deck.html"}).when("/decks",{templateUrl:"decks/decks.html",name:"My Decks"}).when("/",{redirectTo:"/decks"}).otherwise({templateUrl:"404/404.html",name:"Page Not Found"})}return t.$inject=["$routeProvider"],t}();angular.module("app").config(e),angular.module("app").run(["$rootScope",function(t){t.$on("$routeChangeSuccess",function(e,n){t.pageSize=n.pageSize,n.name&&(document.title=n.name)})}])}(app||(app={}));var app;!function(t){var e=function(){function t(t){var e=this;this.on=function(t,n){e.listeners[t]=e.listeners[t]||[],e.listeners[t].push(n)},this.unsubscribe=function(t,n){var r=e.listeners[t],i=r.indexOf(n);i>-1&&r.splice(i,1)},this.broadcast=function(t){var n=e.listeners[t];n&&n.forEach(function(t){var n={target:e.target};t(n)})},this.target=t,this.listeners={}}return t}();t.Arbiter=e}(app||(app={})),Array.prototype.except||(Array.prototype.except=function(t){return this.filter(function(e){return t.indexOf(e)===-1})});var app;!function(t){var e=function(){function t(){}return t}();t.CardSet=e}(app||(app={}));var app;!function(t){var e=function(){function t(){}return t.parse=function(t,e){e=e||",";var n=t.split("\n"),r=n.shift().split(e);return n.reduce(function(t,n){if(0===n.trim().length)return t;for(var i=n.split(e),a={},c=0;c<r.length;++c)a[r[c]]=i[c];return t.push(a),t},[])},t.stringify=function(t,e,n){return n=n||",",t.reduce(function(t,r){return t+e.map(function(t){return r[t]}).join(n)+"\n"},e.join(n)+"\n")},t}();t.CSV=e}(app||(app={}));var app;!function(t){var e=function(){function t(){}return t.fromArray=function(t,e){return t.reduce(function(t,n){return t[e(n)]=n,t},{})},t.toArray=function(t){return Object.keys(t).map(function(e){return t[e]})},t}();t.Dictionary=e}(app||(app={}));var app;!function(t){var e=function(){function t(){var t=this;this.exec=function(e,n,r){for(var i=e.map(r),a=t.generateReferenceArray(i),c=[i.length],o=i.reduce(function(t,e){return t+e},0);;){var s=t.split(a,o-1);if(void 0===s)break;if(s.groupSizes.length>n)break;c=s.groupSizes,o=s.largestSize}for(var u=0,d=c.map(function(t){var n=e.slice(u,u+t);return u+=t,n}),l=n-d.length,p=0;p<l;++p)d.push([]);return d},this.generateReferenceArray=function(t){for(var e=[],n=0;n<t.length;++n){var r=0,i=[];e.push(i);for(var a=n;a<t.length;++a)r+=t[a],i.push(r)}return e},this.split=function(t,e){for(var n=[],r=0,i=0;i<t.length;){var a=t[i];if(a[0]>e)return;for(var c=0;c<a.length-1&&!(a[c+1]>e);++c);r=a[c]>r?a[c]:r,n.push(c+1),i=i+c+1}return{groupSizes:n,largestSize:r}}}return t}();t.GroupEvenly=e}(app||(app={}));var app;!function(t){var e=function(){function t(){}return t}();t.Stat=e}(app||(app={}));var app;!function(t){var e=function(){function t(){}return t}();t.StatGroup=e}(app||(app={}));var app;!function(t){var e=function(){function t(){this.restrict="A",this.link=function(t,e){e.bind("keydown",function(t){if(9===t.keyCode){t.preventDefault();var e=t.target,n=e.selectionStart,r=e.selectionEnd,i=e.value;e.value=i.substring(0,n)+"\t"+i.substring(r),e.selectionStart=n+1,e.selectionEnd=e.selectionStart}})}}return t}();angular.module("app").directive("allowTabs",function(){return new e})}(app||(app={}));var app;!function(t){var e=function(){function t(t){var e=this;this.config=t,this.getOffset=function(t){var e=t.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,r=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+r,left:e.left+n}},this.showCardPreview=function(t,n){var r=document.getElementById("card-preview");r||(r=document.createElement("img"),r.id="card-preview",document.body.appendChild(r));var i=e.getOffset(t.currentTarget);r.style.top=i.top-100+"px",r.style.left=i.left+t.currentTarget.offsetWidth+20+"px",r.src=n},this.hideCardPreview=function(){var t=document.getElementById("card-preview");t&&(t.src="",t.style.top="-300px",t.style.left="-200px")},this.restrict="A",this.link=function(t,n,r){var i,a=function(n){if(e.config.enableHover){if(!i){var a=t.$eval(r.lightbox);i=e.config.imagesUrl.replace(/{([^}]*)}/,a)}e.showCardPreview(n,i)}},c=function(t){e.config.enableHover&&e.hideCardPreview()};n[0].addEventListener("mouseover",a),n[0].addEventListener("mouseleave",c),t.$on("$destroy",function(){e.hideCardPreview(),n[0].removeEventListener("mouseover",a),n[0].removeEventListener("mousleave",c)})}}return t}();angular.module("app").directive("cardPreview",["config",function(t){return new e(t)}])}(app||(app={}));var app;!function(t){var e=function(){function t(t,e){var n=this;this.$compile=t,this.$rootScope=e,this.restrict="E",this.link=function(t,e,r){var i;t.$watch(r.directive,function(a){var c=Object.keys(r).reduce(function(t,e){if("$"!==e[0]&&"directive"!==e){var n=e+'="'+r[e]+'"';t.push(n)}return t},[]).join(" "),o="<"+a+" "+c+"></"+a+">";i&&i.$destroy(),i=t.$new(),Object.keys(r).forEach(function(t){"$"!==t[0]&&"directive"!==t&&(i[t]=r[t])});var s=n.$compile(o)(i);e[0].firstChild&&e[0].firstChild.remove(),e.append(s)})}}return t}();angular.module("app").directive("directiveContainer",["$compile","$rootScope",function(t,n){return new e(t,n)}])}(app||(app={}));var app;!function(t){var e=function(){function t(t){var e=this;this.config=t,this.showLightbox=function(t,e){var n=document.createElement("div");n.className="lightbox";var r=document.createElement("img");r.src=e;var i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;3*a>>2>i?r.style.width="90%":r.style.height="90%",n.appendChild(r),n.addEventListener("click",function(t){n.remove()}),document.body.appendChild(n),t.preventDefault()},this.restrict="A",this.link=function(t,n,r){var i;n[0].addEventListener("click",function(n){if(!i){var a=t.$eval(r.lightbox);i=e.config.imagesUrl.replace(/{([^}]*)}/,a)}e.showLightbox(n,i)})}}return t}();angular.module("app").directive("lightbox",["config",function(t){return new e(t)}])}(app||(app={}));var app;!function(t){var e=function(){function t(){this.restrict="A",this.template="<span></span>",this.link=function(t,e,n){var r=0,i="0123".split(""),a=void 0;e[0].className="icon";var c=function(){e[0].textContent=i[r],r=r+1>=i.length?0:r+1};c(),a=window.setInterval(c,150),t.$on("$destroy",function(){void 0!=a&&window.clearInterval(a)})}}return t}();angular.module("app").directive("textSpinner",function(){return new e})}(app||(app={}));var app;!function(t){var e=function(){function e(e,n,r){var i=this;this.$q=e,this.cardDefinitions=n,this.CardPriceService=r,this.on=function(t,e){return i.arbiter.on(t,e)},this.unsubscribe=function(t,e){return i.arbiter.unsubscribe(t,e)},this.setCardBlob=function(t){i.parseCardBlob(t),i.cardBlob=i.failedCards.concat(i.cards.sort(function(t,e){return t.definition.name>e.definition.name?1:-1}).map(function(t){return t.quantity+"x "+t.definition.name})).join("\n"),i.count=i.cards.reduce(function(t,e){return t+Number(e.quantity)},0),i.arbiter.broadcast("changed")},this.destroy=function(){i.timeout&&i.timeout.resolve()},this.loadPrices=function(){if(i.loadPricesPromise)return i.loadPricesPromise;var e=i.cards.filter(function(t){return!t.usd}).map(function(t){return t.definition.name});return 0===e.length?i.$q.when():(i.timeout=i.$q.defer(),i.loadPricesPromise=i.CardPriceService.getCardPrices(e,i.timeout.promise).then(function(e){var n=t.Dictionary.fromArray(e,function(t){return t.name});i.cards.forEach(function(t){if(void 0===t.usd){var e=n[t.definition.name.toLowerCase()];t.usd=e?Number(e.usd)*t.quantity:null}}),i.usd=i.cards.reduce(function(t,e){return t+e.usd},0),i.arbiter.broadcast("prices-changed")})["finally"](function(){delete i.timeout,delete i.loadPricesPromise}),i.loadPricesPromise)},this.parseCardBlob=function(e){if(e=e.trim(),i.cards=[],i.failedCards=[],0!==e.length){var n={};e.split(/\n[\s\n]*/).forEach(function(t){var e=/^(?:(\d+)[Xx]?\s)?\s*([^0-9]+)$/.exec(t.trim());if(!e)return void i.failedCards.push(t);var r=i.cardDefinitions[e[2].toLowerCase()];if(!r)return void i.failedCards.push(t);var a=n[r.name]=n[r.name]||{definition:r,quantity:0,usd:void 0};a.quantity+=Number(e[1])||1}),i.cards=t.Dictionary.toArray(n)}},this.name="",this.cards=[],this.failedCards=[],this.count=0,this.cardBlob="",this.arbiter=new t.Arbiter(this)}return e}();t.CardGroup=e}(app||(app={}));var app;!function(t){var e=function(){function t(t,e){var n=this;this.$q=t,this.DeckService=e,this.save=function(){return n.id?n.DeckService.updateDeck(n):n.DeckService.createDeck(n).then(function(t){n.id=t})},this["delete"]=function(){return n.id?n.DeckService.deleteDeck(n.id).then(function(){n.id=void 0}):n.$q.reject()},this.destroy=function(){n.cardGroups.forEach(function(t){return t.destroy()})},this.loadPrices=function(){return n.$q.all(n.cardGroups.map(function(t){return t.loadPrices()}))}}return t}();t.Deck=e}(app||(app={}));var app;!function(t){var e=function(){function t(t,e,n,r){var i=this;this.$auth=t,this.$rootScope=e,this.config=n,this.UserService=r,this.login=function(){return i.$auth.authenticate("google").then(function(){return i.UserService.getMe().then(function(t){return localStorage.setItem(i.config.localStorage.user,JSON.stringify(t)),i.updateAuthenticationStatus(),t},i.logout)})},this.logout=function(){return i.$auth.logout().then(function(){localStorage.removeItem(i.config.localStorage.user),localStorage.removeItem(i.config.localStorage.tags),i.updateAuthenticationStatus()})},this.isLoggedIn=function(){return!!i.$auth.isAuthenticated()||void(i.isAuthenticated&&i.logout())},this.getAuthUser=function(){var t=void 0;if(i.$auth.isAuthenticated()){var t=JSON.parse(localStorage.getItem(i.config.localStorage.user));void 0===t&&i.logout()}else i.isAuthenticated&&i.logout();return t},this.updateAuthenticationStatus=function(){i.isAuthenticated=i.$auth.isAuthenticated(),i.$rootScope.$broadcast("authentication-changed")},this.isAuthenticated=this.$auth.isAuthenticated(),this.isAuthenticated||this.logout()}return t.$inject=["$auth","$rootScope","config","UserService"],t}();t.AuthService=e,angular.module("app").service("AuthService",e)}(app||(app={}));var app;!function(t){var e=function(){function e(t){this.$injector=t}return e.$inject=["$injector"],e.prototype.createCardGroup=function(){var e=this.$injector.get("$q"),n=this.$injector.get("CardPriceService"),r=this.$injector.get("CardDefinitions");return new t.CardGroup(e,r,n)},e}();t.CardGroupFactory=e,angular.module("app").service("CardGroupFactory",e)}(app||(app={}));var app;!function(t){var e=function(){function e(e,n,r){var i=this;this.$http=n,this.$q=r,this.getCardPrices=function(t,e){t=t.map(function(t){return t.toLowerCase()});var n=i.getKnownCards(t),r=t.except(n.map(function(t){return t.name}));return i.getUnknownCards(r,e).then(function(t){var e=(new Date).getTime().toString();return t.forEach(function(t){return t.modifiedOn=e}),i.save(t),n.concat(t)})},this.getCache=function(){var e=localStorage.getItem(i.key);return e?t.CSV.parse(e,"\t"):[]},this.setCache=function(e){localStorage.setItem(i.key,t.CSV.stringify(e,["name","usd","modifiedOn"],"\t"))},this.getKnownCards=function(e){if(0===e.length||0===i.cardCacheLimit||0===i.expirationMs)return[];var n=(new Date).getTime()-i.expirationMs,r=t.Dictionary.fromArray(i.getCache(),function(t){return t.name});return e.reduce(function(t,e){var i=r[e];return i&&Number(i.modifiedOn)>n&&t.push(i),t},[])},this.getUnknownCards=function(e,n){if(0===e.length)return i.$q.when([]);var r=e.join("\n"),a={headers:{"Content-Type":"application/text",timeout:n}};return i.$http.post(i.url,r,a).then(function(e){return t.CSV.parse(e.data,"\t")})},this.save=function(e){if(0!==e.length&&0!==i.cardCacheLimit&&0!==i.expirationMs){var n=(new Date).getTime()-i.expirationMs,r=i.getCache().reduce(function(t,e){return Number(e.modifiedOn)>n&&(t[e.name]=e),t},{});e.forEach(function(t){return r[t.name]=t});var a=t.Dictionary.toArray(r);a.length>i.cardCacheLimit&&(a=a.sort(function(t,e){return Number(t.modifiedOn)<Number(e.modifiedOn)?1:-1}),a.splice(i.cardCacheLimit)),i.setCache(a)}},this.url=e.cardsUrl,this.key=e.localStorage.cards,this.cardCacheLimit=e.cardCacheLimit||0,this.expirationMs=e.cardExpirationMs||0}return e.$inject=["config","$http","$q"],e}();t.CardPriceService=e,angular.module("app").service("CardPriceService",e)}(app||(app={}));var app;!function(t){var e=function(){function e(t){this.$injector=t}return e.$inject=["$injector"],e.prototype.createDeck=function(){return new t.Deck(this.$injector.get("$q"),this.$injector.get("DeckService"))},e}();t.DeckFactory=e,angular.module("app").service("DeckFactory",e)}(app||(app={}));var app;!function(t){var e=function(){function t(t,e,n,r){var i=this;this.$http=e,this.DeckFactory=n,this.CardGroupFactory=r,this.getDeck=function(t,e){return i.$http.get(i.url+"/"+t,{timeout:e}).then(function(t){return i.mapApiDeck(t.data)})},this.getDecksByQuery=function(t,e){return i.$http.get(i.url,{params:t,timeout:e}).then(function(t){return t.data.results})},this.createDeck=function(t){return i.$http.post(i.url,i.mapDeck(t)).then(function(t){return t.data.id})},this.updateDeck=function(t){return i.$http.put(i.url+"/"+t.id,i.mapDeck(t))},this.deleteDeck=function(t){return i.$http["delete"](i.url+"/"+t)},this.mapApiDeck=function(t){var e=i.DeckFactory.createDeck();return e.id=t.id,e.name=t.name,e.owners=t.owners,e.cardGroups=t.cardGroups.map(function(t){var e=i.CardGroupFactory.createCardGroup();return e.name=t.name,e.setCardBlob(t.cardBlob),e}),e.notes=t.notes,e.tags=t.tags,e},this.mapDeck=function(t){return{id:void 0,owners:void 0,name:t.name,cardGroups:t.cardGroups.map(function(t){return{name:t.name,cardBlob:t.cardBlob}}),notes:t.notes,tags:t.tags}},this.url=t.decksUrl}return t.$inject=["config","$http","DeckFactory","CardGroupFactory"],t}();t.DeckService=e,angular.module("app").service("DeckService",e)}(app||(app={}));var app;!function(t){var e=function(){function t(t,e){var n=this;this.$http=t,this.config=e,this.getMe=function(){return n.$http.post(n.config.usersUrl+"/me",{}).then(function(t){return n.mapApiUser(t.data)})},this.mapApiUser=function(t){return{id:t.id}}}return t.$inject=["$http","config"],t}();t.UserService=e,angular.module("app").service("UserService",e)}(app||(app={}));var app;!function(t){var e=function(){function t(t){var e=this;this.AuthService=t,this.login=function(){return e.isLoggingIn=!0,e.AuthService.login()["finally"](function(){e.isLoggingIn=!1})},this.logout=function(){return e.AuthService.logout()},this.isLoggedIn=function(){return e.AuthService.isLoggedIn()}}return t.$inject=["AuthService"],t}();angular.module("app").controller("AuthController",e)}(app||(app={}));var app;!function(t){var e=function(){function t(){this.restrict="E",this.scope={canEdit:"=",group:"=",isEditing:"@"},this.templateUrl="cardGroup/cardGroup.html"}return t}();angular.module("app").directive("cardGroup",function(){return new e})}(app||(app={}));var app;!function(t){var e=function(){function t(t,e){var n=this;this.$scope=t,this.view="group-by-type",this.updateEditability=function(){n.canEdit=n.$scope.canEdit,n.$scope.canEdit||n.discardChanges()},this.startEditing=function(){n.cardsBlob=n.cardGroup.cardBlob,n.isEditing=!0},this.applyChanges=function(){n.form.$dirty&&n.cardGroup.setCardBlob(n.cardsBlob),n.isEditing=!1},this.discardChanges=function(){n.isEditing=!1},this.isEmpty=function(){return n.cardGroup.cards.length+(n.cardGroup.failedCards||[]).length===0},this.cardGroup=this.$scope.group,this.updateEditability(),this.$scope.$watch("canEdit",this.updateEditability),"true"===this.$scope.isEditing?this.startEditing():this.discardChanges()}return t.$inject=["$scope","config"],t}();angular.module("app").controller("CardGroupController",e)}(app||(app={}));var app;!function(t){var e=function(){function e(){var e=this;this.groupByCmc=function(e){var n=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],r=n.reduce(function(n,r){var i=new t.CardSet;return i.name=r.toString()+" drop",i.cards=e.filter(function(t){return t.definition.cmc===r}),i.numberOfCards=i.cards.reduce(function(t,e){return t+e.quantity},0),i.cards.length>0&&n.push(i),n},[]);return(new t.GroupEvenly).exec(r,3,function(t){return t.cards.length+4})},this.restrict="E",this.scope={cardgroup:"="},this.templateUrl="cardSet/groupBy1.html",this.link=function(t){t.columns=e.groupByCmc(t.cardgroup.cards)}}return e}();angular.module("app").directive("groupByCmc",function(){return new e})}(app||(app={}));var app;!function(t){var e=function(){function e(){var e=this;this.groupByColor=function(e){var n=["white","blue","black","red","green","multicolored","colorless"],r=n.reduce(function(n,r){var i=new t.CardSet;return i.name=r,i.cards=e.filter(function(t){return t.definition.color===r}),i.numberOfCards=i.cards.reduce(function(t,e){return t+e.quantity},0),i.cards.length>0&&n.push(i),n},[]);return(new t.GroupEvenly).exec(r,3,function(t){return t.cards.length+4})},this.restrict="E",this.scope={cardgroup:"="},this.templateUrl="cardSet/groupBy1.html",this.link=function(t){t.columns=e.groupByColor(t.cardgroup.cards)}}return e}();angular.module("app").directive("groupByColor",function(){return new e})}(app||(app={}));var app;!function(t){var e=function(){function t(){var t=this;this.groupByName=function(t){var t=t.slice(0).sort(function(t,e){return t.definition.name>e.definition.name?1:-1}),e=Math.ceil(t.length/3);return[[{name:void 0,numberOfCards:void 0,cards:t.slice(0,e)}],[{name:void 0,numberOfCards:void 0,cards:t.slice(e,e+e)}],[{name:void 0,numberOfCards:void 0,cards:t.slice(e+e)}]]},this.restrict="E",this.scope={cardgroup:"="},this.templateUrl="cardSet/groupBy2.html",this.link=function(e){e.columns=t.groupByName(e.cardgroup.cards)}}return t}();angular.module("app").directive("groupByName",function(){return new e})}(app||(app={}));var app;!function(t){var e=function(){function t(){var t=this;this.groupByPrice=function(t){var t=t.slice(0).sort(function(t,e){return Math.round(100*t.usd)===Math.round(100*e.usd)?t.definition.name>e.definition.name?1:-1:t.usd>e.usd?1:-1}),e=Math.ceil(t.length/3);return[[{name:void 0,numberOfCards:void 0,cards:t.slice(0,e)}],[{name:void 0,numberOfCards:void 0,cards:t.slice(e,e+e)}],[{name:void 0,numberOfCards:void 0,cards:t.slice(e+e)}]]},this.restrict="E",this.scope={cardgroup:"="},this.templateUrl="cardSet/groupBy2.html",this.link=function(e){var n=e.cardgroup,r=function(){return e.columns=t.groupByPrice(n.cards)};n.on("prices-changed",r),e.$on("$destroy",function(){return n.unsubscribe("prices-changed",r)}),n.loadPrices(),r()}}return t}();angular.module("app").directive("groupByPrice",function(){return new e})}(app||(app={}));var app;!function(t){var e=function(){function e(){var e=this;this.groupByType=function(e){var n=["creature","artifact","enchantment","planeswalker","land","instant","sorcery"],r=n.reduce(function(n,r){var i=new t.CardSet;return i.name=r,i.cards=e.filter(function(t){return t.definition.primaryType===r}),i.numberOfCards=i.cards.reduce(function(t,e){return t+e.quantity},0),i.cards.length>0&&n.push(i),n},[]);return(new t.GroupEvenly).exec(r,3,function(t){return t.cards.length+4})},this.restrict="E",this.scope={cardgroup:"="},this.templateUrl="cardSet/groupBy1.html",this.link=function(t){t.columns=e.groupByType(t.cardgroup.cards)}}return e}();angular.module("app").directive("groupByType",function(){return new e})}(app||(app={}));var app;!function(t){var e=function(){function t(){this.restrict="E",this.scope={id:"="},this.templateUrl="deck/deck.html"}return t}();angular.module("app").directive("deck",function(){return new e})}(app||(app={}));var app;!function(t){var e=function(){function t(t,e,n,r,i,a,c,o,s,u){var d=this;this.$location=e,this.$q=n,this.$scope=r,this.config=i,this.AuthService=a,this.DeckService=c,this.DeckFactory=o,this.CardPriceService=s,this.CardGroupFactory=u,this.togglePrices=function(){d.showPrices=!d.showPrices,d.showPrices&&(d.showPricesSpinner=!0,d.deck.loadPrices()["finally"](function(){return d.showPricesSpinner=!1}))},this.updateTitle=function(){document.title=d.deck.name},this.sync=function(){var t=d.AuthService.getAuthUser();d.canCreate=void 0!==t,d.canEdit=!d.deck.id||t&&d.deck.owners.indexOf(t.id)>=0,d.canCreate&&!d.deck.id&&d.deck.cardGroups.some(function(t){return t.cards.length>0})&&d.save()},this.save=function(){d.updateTitle();var t=d.AuthService.getAuthUser();void 0!==t&&(d.isSaving=!0,d.deck.save().then(function(){d.deck.owners=d.deck.owners||[t.id],d.$location.update_path("/decks/"+d.deck.id)})["finally"](function(){d.isSaving=!1}))},this["delete"]=function(){var t=confirm("Are you sure you want to delete this deck?");t&&(d.isDeleting=!0,d.deck["delete"]().then(function(){location.hash="/decks"})["finally"](function(){d.isDeleting=!1}))},this.getDeck=function(t){return"new"===t?d.$q.when(d.createNewDeck()):(document.title="Loading",d.timeout=d.$q.defer(),d.DeckService.getDeck(t,d.timeout.promise).then(function(t){return t})["finally"](function(){delete d.timeout}))},this.createNewDeck=function(){var t=d.DeckFactory.createDeck();t.name="New Deck";var e=d.CardGroupFactory.createCardGroup(),n=d.CardGroupFactory.createCardGroup();e.name="Mainboard",n.name="Sideboard",t.cardGroups=[e,n],t.notes="";var r=JSON.parse(localStorage.getItem(d.config.localStorage.tags));return r&&r.current&&(t.tags=[r.current]),t},this.destroy=function(){d.timeout&&d.timeout.resolve(),d.deck&&d.deck.destroy()},this.getDeck(t.id).then(function(t){d.deck=t,d.sync(),d.updateTitle(),d.deck.cardGroups.forEach(function(t){t.on("changed",function(t){d.save(),d.showPrices&&t.target.loadPrices()})})}),this.$scope.$on("authentication-changed",this.sync),this.$scope.$on("$destroy",this.destroy)}return t.$inject=["$routeParams","$location","$q","$scope","config","AuthService","DeckService","DeckFactory","CardPriceService","CardGroupFactory"],t}();angular.module("app").controller("DeckController",e)}(app||(app={}));var app;!function(t){var e=function(){function t(){
this.restrict="E",this.templateUrl="decks/decks.html"}return t}();angular.module("app").directive("decks",function(){return new e})}(app||(app={}));var app;!function(t){var e=function(){function t(t,e,n,r,i){var a=this;this.$q=t,this.$scope=e,this.AuthService=n,this.config=r,this.DeckService=i,this.getDecks=function(){a.timeout=a.$q.defer();var t=a.AuthService.getAuthUser();a.DeckService.getDecksByQuery({owner:t.id},a.timeout.promise).then(function(t){a.decks=t.sort(function(t,e){return t.name>e.name?1:-1}),a.tags=t.reduce(function(t,e){return e.tags.forEach(function(e){e=e.toLocaleLowerCase(),t.indexOf(e)===-1&&t.push(e)}),t},[]),a.tags.indexOf(a.currentTag)<0&&delete a.currentTag,a.filterDecks()})["finally"](function(){delete a.timeout})},this.filterDecks=function(){return a.syncTags(),a.currentTag?"Untagged"==a.currentTag?void(a.visibleDecks=a.decks.filter(function(t){return 0===t.tags.length})):void(a.visibleDecks=a.decks.filter(function(t){return t.tags.some(function(t){return t.toLocaleLowerCase()===a.currentTag.toLocaleLowerCase()})})):void(a.visibleDecks=a.decks)},this.sync=function(){var t=a.AuthService.getAuthUser();void 0===t&&(a.cancelPendingRequests(),delete a.decks,delete a.visibleDecks,delete a.tags,delete a.currentTag),void 0!==t&&void 0===a.decks&&a.getDecks()},this.syncTags=function(){void 0===a.tags&&localStorage.removeItem(a.config.localStorage.tags);var t={all:a.tags,current:a.currentTag};localStorage.setItem(a.config.localStorage.tags,JSON.stringify(t))},this.cancelPendingRequests=function(){a.timeout&&a.timeout.resolve()},this.sync(),this.$scope.$on("authentication-changed",this.sync),this.$scope.$on("$destroy",this.cancelPendingRequests);var c=JSON.parse(localStorage.getItem(this.config.localStorage.tags));c&&(this.tags=c.all,this.currentTag=c.current)}return t.$inject=["$q","$scope","AuthService","config","DeckService"],t}();angular.module("app").controller("DecksController",e)}(app||(app={}));var app;!function(t){var e=function(){function t(){this.restrict="E",this.templateUrl="spinner/spinner.html"}return t}();angular.module("app").directive("spinner",function(){return new e})}(app||(app={}));var app;!function(t){var e=function(){function t(){this.restrict="E",this.scope={group:"="},this.templateUrl="statGroup/statGroup.html"}return t}();angular.module("app").directive("statGroup",function(){return new e})}(app||(app={}));var app;!function(t){var e=function(){function t(){this.restrict="E",this.scope={cards:"="},this.templateUrl="stats/statsView.html"}return t}();angular.module("app").directive("stats",function(){return new e})}(app||(app={}));var app;!function(t){var e=function(){function e(e,n){var r=this;this.unique=function(t,e,n){return n.indexOf(t)===e},this.createStatGroup=function(e,n){var i=new t.StatGroup;i.name=n.name;var a=e.filter(function(t){return n.types.indexOf(t.definition.primaryType)>=0}),c=a.map(function(t){return t.definition.cmc}).filter(r.unique).sort();i.stats=[];for(var o=0;o<=c[c.length-1];++o){var s=new t.Stat;s.name=o.toString(),s.value=a.filter(function(t){return t.definition.cmc===o}).reduce(function(t,e){return t+Number(e.quantity)},0),i.stats.push(s)}return i},this.createStatGroups=function(t,e){return e.map(function(e){return r.createStatGroup(t,e)})},this.updateStats=function(t,e,n){t&&t.length>0?r.statGroups=r.createStatGroups(t,r.categories):r.statGroups=[]},this.categories=n.statCategories,e.$watchCollection("cards",this.updateStats)}return e.$inject=["$scope","config"],e}();angular.module("app").controller("StatsController",e)}(app||(app={}));