angular.module("templates",[]).run(["$templateCache",function(e){e.put("auth/auth.html",'<div ng-controller="authController as vm"><button ng-click=vm.login() ng-if=!vm.isLoggedIn() ng-disabled=vm.isLoggingIn><span ng-if=vm.isLoggingIn>Logging In <span text-spinner></span></span> <span ng-if=!vm.isLoggingIn>Login</span></button> <button ng-click=vm.logout() ng-if=vm.isLoggedIn()>Logout</button></div>'),e.put("cardGroup/cardGroup.html",'<div ng-controller="CardGroupController as vm"><header class="flex padding-h-lte-sm" ng-if=!vm.isEditing><button class="header-button text-left-gte-sm" ng-click="vm.showToolbar = !vm.showToolbar"><div>{{::vm.cardGroup.name}} <span class=icon ng-if="vm.cards.length > 0">{{vm.showToolbar ? "7" : "4"}}</span></div><div class="small light">{{::vm.count}} cards <span class=price ng-if=::vm.usd>&#8226; ${{vm.usd | number: 2}}</span></div></button><span class=header-button ng-if=canEdit ng-click=vm.startEditing()>Edit</span></header><header class="flex padding-h-lte-sm" ng-if=vm.isEditing><button class="header-button text-left-gte-sm" ng-click=vm.applyChanges()><div>{{::vm.cardGroup.name}} <span class=icon ng-if="vm.cards.length > 0">{{vm.showToolbar ? "7" : "4"}}</span></div><div class="small light">{{::vm.count}} cards <span class=price ng-if=::vm.usd>&#8226; ${{vm.usd | number: 2}}</span></div></button><span class=tab>Edit</span></header><form><div class=radio-group ng-show="vm.cards.length > 0 && !vm.isEditing && vm.showToolbar"><label><input type=radio name=view checked ng-click=vm.setGroupFunc(vm.cardGrouper.groupByType)> Card Type</label> <label><input type=radio name=view ng-click=vm.setGroupFunc(vm.cardGrouper.groupByColor)> Color</label> <label><input type=radio name=view ng-click=vm.setGroupFunc(vm.cardGrouper.groupByCmc)> Converted Mana Cost</label> <label><input type=radio name=view ng-click=vm.setGroupFunc(vm.cardGrouper.groupByName)> Name</label> <label><input type=radio name=view ng-click=vm.setGroupFunc(vm.cardGrouper.groupByPrice)> Price</label></div></form><div class="alert alert-danger margin" ng-if="vm.invalidCards.length > 0"><p class=alert-title>Unknown Cards</p><span ng-repeat="card in vm.invalidCards track by $index">{{card}}<br></span></div><div ng-if="!vm.isEditing && vm.cards.length > 0"><card-view columns=vm.cardView show-headers=vm.showHeaders></card-view></div><form name=vm.form class=margin ng-if=vm.isEditing><textarea class="form-control has-bottom-buttons" placeholder="4x Island" ng-model=vm.cardBlob msd-elastic></textarea><div class=bottom-buttons><button class="btn btn-default" type=button ng-click=vm.applyChanges()>Apply Changes</button><button class="btn btn-default" type=button ng-click=vm.discardChanges()>Discard Changes</button></div></form></div>'),e.put("cardView/cardView.html",'<div class="flex-gte-sm margin" style=margin-bottom:0; ng-if=showHeaders><div ng-repeat="column in columns"><div class=card-group ng-repeat="row in ::column"><p class="large capitalize" ng-if=::row.name>{{::row.name}} <span class=light>&#8226; {{::row.numberOfCards}}</span></p><p><span ng-repeat="card in ::row.cards"><span class="quantity light">{{::card.quantity}}</span> <a href=# class=name card-preview=card.definition.imageUri lightbox=card.definition.imageUri>{{::card.definition.name}}</a> <span class="price small light">{{::card.usd | number: 2}}</span><br></span></p></div></div></div><div class="flex-gte-sm margin" ng-if=!showHeaders><div ng-repeat="column in columns"><div class=card-group ng-repeat="row in ::column"><span ng-repeat="card in ::row.cards"><span class="quantity light">{{::card.quantity}}</span> <a href=# class=name card-preview=card.definition.imageUri lightbox=card.definition.imageUri>{{::card.definition.name}}</a> <span class="price small light">{{::card.usd | number: 2}}</span><br></span></div></div></div>'),e.put("deck/deck.html",'<main ng-controller="deckController as vm" class="{{vm.showPrices ? \'show-prices\' : \'hide-prices\'}}"><nav><a href=#/decks>My Decks</a><div class=pull-right><auth></auth></div></nav><spinner class=light ng-if=vm.isLoading></spinner><div ng-if=vm.deck><section><header class=deck-info><div class=deck-name ng-if=!vm.canWrite>{{vm.deck.name}}</div><input class="form-control deck-name-input" ng-model=vm.deck.name ng-model-options="{updateOn: \'default blur\', debounce: {default: 2000, blur: 0}}" ng-change=vm.save() ng-if=vm.canWrite><div class="flex flex-padding"><button class="btn btn-default margin-top" ng-click=vm.togglePrices()>{{vm.showPrices ? "Hide Prices" : "Show Prices"}} <span text-spinner ng-if="vm.isLoadingPrices && vm.showPrices"></span></button><button class="btn btn-default margin-top" ng-click=vm.delete() ng-if="vm.canWrite && vm.deck.id" ng-disabled=vm.isDeleting><span ng-if=!vm.isDeleting>Delete this Deck</span> <span ng-if=vm.isDeleting>Deleting <span text-spinner></span></span></button></div></header></section><div class=flex-gte-md><section class=flex-2><div ng-repeat="cardGroup in ::vm.deck.cardGroups"><card-group data=cardGroup can-edit=vm.canWrite is-editing="{{::$index === 0 && !vm.deck.id}}" should-load-prices=vm.loadPrices card-group-changed=vm.cardGroupChanged cards-changed=vm.cardsChanged prices-loaded=vm.pricesLoaded></card-group></div></section><section class=border-left-gte-md><header class=padding>Notes</header><div ng-if="!vm.canWrite && vm.deck.tags.length > 0"><div class=tags><span class=badge ng-repeat="tag in vm.deck.tags">{{tag}}</span></div><hr class=dashed></div><div class=tag-input ng-if=vm.canWrite><input type=text class="tags transparent" placeholder=tags ng-model=vm.deck.tags ng-model-options="{updateOn: \'default blur\', debounce: {default: 2000, blur: 0}}" ng-list ng-change=vm.onTagsChanged()><hr class=dashed><div><span class=badge ng-repeat="tag in vm.deck.tags track by $index">{{tag}}</span></div></div><textarea class=transparent placeholder=notes ng-model=vm.deck.notes ng-model-options="{updateOn: \'default blur\', debounce: {default: 2000, blur: 0}}" ng-change=vm.save() ng-disabled=!vm.canWrite allow-tabs msd-elastic></textarea><header class=padding>Stats</header><stats cards=vm.statCards></stats></section></div></div></main>'),e.put("decks/decks.html",'<main class=sm ng-controller="decksController as vm"><nav><div class=select><div class=select-label>{{vm.currentTagName}}<span class=spacer></span><span class=icon style=position:absolute;right:15px; ng-show="vm.tags.length > 0">4</span></div><select ng-model=vm.currentTagOptionIndex ng-change=vm.onCurrentTagOptionIndexChanged() ng-if="vm.tags.length > 0"><option value=0>- All -</option><option value=1>- Untagged -</option><option ng-repeat="tag in vm.tags" value="{{$index + 2}}">{{::tag}}&nbsp;&nbsp;</option></select></div><div class=pull-right><auth></auth></div></nav><div class=list-group><a class=list-group-item href=#/decks/new><strong>+</strong> Build a New Deck</a> <a class=list-group-item href=#/decks/{{::deck.id}} ng-repeat="deck in vm.visibleDecks">{{::deck.name}} <span class="badge pull-right" ng-repeat="tag in ::deck.tags track by $index">{{::tag}}</span></a></div><spinner class=light ng-if=vm.isLoading></spinner></main>'),e.put("notFound/notFound.html",'<main class="sm text-center" style=color:#f5f5f5;><nav><a href=#/decks>My Decks</a><div class=pull-right><auth></auth></div></nav><h1>404</h1><span>~(=^..^)</span></main>'),e.put("spinner/spinner.html",'<div class=sk-fading-circle><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div>'),e.put("stats/statsView.html",'<div class="stat-group margin" ng-if="vm.stats && vm.stats.length > 0"><p class="large capitalize">Cmc</p><div class=stat-group-row ng-repeat="stat in vm.stats"><span class=name>{{::$index}}</span> <span class=bar>{{::stat.value}}</span> <span class=light ng-if="::stat.value.length > 0">{{::stat.value.length}}</span></div></div>')}]);var app;!function(e){angular.module("app",["templates","ngRoute","ngLocationUpdate","satellizer","monospaced.elastic"])}(app||(app={}));var app;!function(e){angular.module("app").constant("config",appConfig),angular.module("app").config(["$authProvider","config",function(e,t){e.google({clientId:t.authClients.google.clientId,url:t.authClients.google.authUrl})}]),angular.module("app").config(["SatellizerConfig","config",function(e,t){e.tokenPrefix=t.localStorage.prefix}]);var t=void 0,n=function(){void 0===t?t=new Date:(new Date).getTime()-t.getTime()<100?(appConfig.enableHover=!0,document.body.removeEventListener("mouseover",n),document.body.addEventListener("touchstart",i)):t=new Date},i=function(){appConfig.enableHover=!1,document.body.removeEventListener("touchstart",i),document.body.addEventListener("mouseover",n)};i()}(app||(app={}));var app;!function(e){var t=function(){function e(e){e.when("/decks/:id",{template:"<deck></deck>"}).when("/decks",{template:"<decks></decks>",name:"My Decks"}).when("/",{redirectTo:"/decks"}).otherwise({template:"<not-found></not-found>",name:"Page Not Found"})}return e.$inject=["$routeProvider"],e}();angular.module("app").config(t),angular.module("app").run(["$rootScope",function(e){e.$on("$routeChangeSuccess",function(t,n){e.pageSize=n.pageSize,n.name&&(document.title=n.name)})}])}(app||(app={}));var app;!function(e){var t=function(){function e(){var e=this;this.listeners=[],this.subscribe=function(t){return e.listeners.push(t),{unsubscribe:function(){var n=e.listeners.indexOf(t);n>-1&&e.listeners.splice(n,1)}}},this.broadcast=function(t){e.listeners.forEach(function(e){e(t)})}}return e}();e.Arbiter=t}(app||(app={})),Array.prototype.except||(Array.prototype.except=function(e){return this.filter(function(t){return e.indexOf(t)===-1})}),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(null==this)throw new TypeError("this is null or not defined");for(var t=Object(this),n=t.length>>>0,i=arguments[1],r=i>>0,a=r<0?Math.max(n+r,0):Math.min(r,n),c=arguments[2],s=void 0===c?n:c>>0,o=s<0?Math.max(n+s,0):Math.min(s,n);a<o;)t[a]=e,a++;return t}});var app;!function(e){var t=function(){function t(){}return t.groupByType=function(e){return t.groupEvenly(t.groupBy(["creature","artifact","enchantment","planeswalker","land","instant","sorcery"],function(e){return e},function(e){return e.definition.primaryType},e))},t.groupByCmc=function(e){return t.groupEvenly(t.groupBy([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],function(e){return e+" drop"},function(e){return e.definition.cmc},e))},t.groupByColor=function(e){return t.groupEvenly(t.groupBy(["white","blue","black","red","green","multicolored","colorless"],function(e){return e},function(e){return e.definition.color},e))},t.groupByName=function(e){e=e.slice().sort(function(e,t){return e.definition.name>t.definition.name?1:-1});var t=Math.ceil(e.length/3);return[[{name:void 0,numberOfCards:void 0,cards:e.slice(0,t)}],[{name:void 0,numberOfCards:void 0,cards:e.slice(t,t+t)}],[{name:void 0,numberOfCards:void 0,cards:e.slice(t+t)}]]},t.groupByPrice=function(e){e=e.slice().sort(function(e,t){return e.usd>t.usd?1:-1});var t=Math.ceil(e.length/3);return[[{name:void 0,numberOfCards:void 0,cards:e.slice(0,t)}],[{name:void 0,numberOfCards:void 0,cards:e.slice(t,t+t)}],[{name:void 0,numberOfCards:void 0,cards:e.slice(t+t)}]]},t.groupBy=function(e,t,n,i){var r=i.reduce(function(e,t){var i=n(t);return e[i]=e[i]||[],e[i].push(t),e},{});return e.reduce(function(e,n){var i=r[n]||[];return i&&i.length>0&&(i=i.sort(function(e,t){return e.definition.name>t.definition.name?1:-1}),e.push({name:t(n),cards:i,numberOfCards:i.reduce(function(e,t){return e+t.quantity},0)})),e},[])},t.groupEvenly=function(t){return e.GroupEvenly.exec(t,3,function(e){return e.cards.length+4})},t}();e.CardGrouper=t}(app||(app={}));var app;!function(e){var t=function(){function e(){}return e.parse=function(e,t){t=t||",";var n=e.split("\n"),i=n.shift().split(t);return n.reduce(function(e,n){if(0===n.trim().length)return e;for(var r=n.split(t),a={},c=0;c<i.length;++c)a[i[c]]=r[c];return e.push(a),e},[])},e.stringify=function(e,t,n){return n=n||",",e.reduce(function(e,i){return e+t.map(function(e){return i[e]}).join(n)+"\n"},t.join(n)+"\n")},e}();e.CSV=t}(app||(app={}));var app;!function(e){var t=function(){function e(){}return e.fromArray=function(e,t){return e.reduce(function(e,n){return e[t(n)]=n,e},{})},e.toArray=function(e){return Object.keys(e).map(function(t){return e[t]})},e}();e.Dictionary=t}(app||(app={}));var app;!function(e){var t=function(){function e(){}return e.exec=function(t,n,i){if(0===t.length)return[];for(var r=t.map(i),a=e.generateReferenceArray(r),c=[r.length],s=r.reduce(function(e,t){return e+t},0);;){var o=e.split(a,s-1);if(void 0===o)break;if(o.groupSizes.length>n)break;c=o.groupSizes,s=o.largestSize}for(var u=0,d=c.map(function(e){var n=t.slice(u,u+e);return u+=e,n}),l=n-d.length,p=0;p<l;++p)d.push([]);return d},e.generateReferenceArray=function(e){for(var t=[],n=0;n<e.length;++n){var i=0,r=[];t.push(r);for(var a=n;a<e.length;++a)i+=e[a],r.push(i)}return t},e.split=function(e,t){for(var n=[],i=0,r=0;r<e.length;){var a=e[r];if(a[0]>t)return;for(var c=0;c<a.length-1&&!(a[c+1]>t);++c);i=a[c]>i?a[c]:i,n.push(c+1),r=r+c+1}return{groupSizes:n,largestSize:i}},e}();e.GroupEvenly=t}(app||(app={}));var app;!function(e){var t=function(){function e(){this.restrict="A",this.link=function(e,t){t.bind("keydown",function(e){if(9===e.keyCode){e.preventDefault();var t=e.target,n=t.selectionStart,i=t.selectionEnd,r=t.value;t.value=r.substring(0,n)+"\t"+r.substring(i),t.selectionStart=n+1,t.selectionEnd=t.selectionStart}})}}return e}();angular.module("app").directive("allowTabs",function(){return new t})}(app||(app={}));var app;!function(e){var t=function(){function e(e){var t=this;this.config=e,this.getOffset=function(e){var t=e.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+i,left:t.left+n}},this.showCardPreview=function(e,n){var i=document.getElementById("card-preview");i||(i=document.createElement("img"),i.id="card-preview",document.body.appendChild(i));var r=t.getOffset(e.currentTarget);i.style.top=r.top-100+"px",i.style.left=r.left+e.currentTarget.offsetWidth+20+"px",i.src=n},this.hideCardPreview=function(){var e=document.getElementById("card-preview");e&&(e.src="",e.style.top="-300px",e.style.left="-200px")},this.restrict="A",this.link=function(e,n,i){var r,a=function(n){if(t.config.enableHover){if(!r){var a=e.$eval(i.lightbox);r=t.config.imagesUrl.replace(/{([^}]*)}/,a)}t.showCardPreview(n,r)}},c=function(e){t.config.enableHover&&t.hideCardPreview()};n[0].addEventListener("mouseover",a),n[0].addEventListener("mouseleave",c),e.$on("$destroy",function(){t.hideCardPreview(),n[0].removeEventListener("mouseover",a),n[0].removeEventListener("mousleave",c)})}}return e}();angular.module("app").directive("cardPreview",["config",function(e){return new t(e)}])}(app||(app={}));var app;!function(e){var t=function(){function e(e){var t=this;this.config=e,this.showLightbox=function(e,t){var n=document.createElement("div");n.className="lightbox";var i=document.createElement("img");i.src=t;var r=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;3*a>>2>r?i.style.width="90%":i.style.height="90%",n.appendChild(i),n.addEventListener("click",function(e){n.remove()}),document.body.appendChild(n),e.preventDefault()},this.restrict="A",this.link=function(e,n,i){var r;n[0].addEventListener("click",function(n){if(!r){var a=e.$eval(i.lightbox);r=t.config.imagesUrl.replace(/{([^}]*)}/,a)}t.showLightbox(n,r)})}}return e}();angular.module("app").directive("lightbox",["config",function(e){return new t(e)}])}(app||(app={}));var app;!function(e){var t=function(){function e(){this.restrict="A",this.template="<span></span>",this.link=function(e,t,n){var i=0,r="0123".split(""),a=void 0;t[0].className="icon";var c=function(){t[0].textContent=r[i],i=i+1>=r.length?0:i+1};c(),a=window.setInterval(c,150),e.$on("$destroy",function(){void 0!=a&&window.clearInterval(a)})}}return e}();angular.module("app").directive("textSpinner",function(){return new t})}(app||(app={}));var app;!function(e){var t=function(){function t(t,n,i){var r=this;this.$auth=t,this.$http=n,this.config=i,this.arbiter=new e.Arbiter,this.login=function(){return r.$auth.authenticate("google").then(function(){return r.$http.post(r.config.usersUrl+"/me",null).then(function(e){localStorage.setItem(r.config.localStorage.user,JSON.stringify(e.data)),r.updateAuthenticationStatus()})["catch"](r.logout)})},this.logout=function(){return r.$auth.logout().then(function(){localStorage.removeItem(r.config.localStorage.user),localStorage.removeItem(r.config.localStorage.tags),r.updateAuthenticationStatus()})},this.isLoggedIn=function(){return!!r.$auth.isAuthenticated()||void(r.isAuthenticated&&r.logout())},this.getAuthUser=function(){var e=void 0;if(r.$auth.isAuthenticated()){var e=JSON.parse(localStorage.getItem(r.config.localStorage.user));void 0===e&&r.logout()}else r.isAuthenticated&&r.logout();return e},this.subscribe=function(e){return r.arbiter.subscribe(e)},this.updateAuthenticationStatus=function(){r.isAuthenticated=r.$auth.isAuthenticated(),r.arbiter.broadcast()},this.isAuthenticated=this.$auth.isAuthenticated(),this.isAuthenticated||this.logout()}return t.$inject=["$auth","$http","config"],t}();e.AuthService=t,angular.module("app").service("authService",t)}(app||(app={}));var app;!function(e){var t=function(){function e(){var e=this;this.getCards=function(){return e.cards},this.cards=cardsCSV.split("\n").slice(1).reduce(function(e,t){var n=t.split("\t"),i={name:n[0],primaryType:n[1],cmc:Number(n[2]),color:n[3],imageUri:n[4]};return e[i.name.toLowerCase()]=i,e},{})}return e}();e.CardDefinitionService=t,angular.module("app").service("cardDefinitionService",t)}(app||(app={}));var app;!function(e){var t=function(){function t(t,n,i){var r=this;this.$http=n,this.$q=i,this.getCardPrices=function(e){e=e.map(function(e){return e.toLowerCase()});var t=r.getKnownCards(e),n=e.except(t.map(function(e){return e.name})),i=r.$q.defer(),a=r.getUnknownCards(n,i.promise).then(function(e){var n=(new Date).getTime().toString();return e.forEach(function(e){return e.modifiedOn=n}),r.save(e),t.concat(e)});return{cancel:function(){return i.resolve()},promise:a}},this.getCache=function(){var t=localStorage.getItem(r.key);return t?e.CSV.parse(t,"\t"):[]},this.setCache=function(t){localStorage.setItem(r.key,e.CSV.stringify(t,["name","usd","modifiedOn"],"\t"))},this.getKnownCards=function(t){if(0===t.length||0===r.cardCacheLimit||0===r.expirationMs)return[];var n=(new Date).getTime()-r.expirationMs,i=e.Dictionary.fromArray(r.getCache(),function(e){return e.name});return t.reduce(function(e,t){var r=i[t];return r&&Number(r.modifiedOn)>n&&e.push(r),e},[])},this.getUnknownCards=function(t,n){if(0===t.length)return r.$q.when([]);var i=t.join("\n"),a={headers:{"Content-Type":"application/text"},timeout:n};return r.$http.post(r.url,i,a).then(function(t){return e.CSV.parse(t.data,"\t")})},this.save=function(t){if(0!==t.length&&0!==r.cardCacheLimit&&0!==r.expirationMs){var n=(new Date).getTime()-r.expirationMs,i=r.getCache().reduce(function(e,t){return Number(t.modifiedOn)>n&&(e[t.name]=t),e},{});t.forEach(function(e){return i[e.name]=e});var a=e.Dictionary.toArray(i);a.length>r.cardCacheLimit&&(a=a.sort(function(e,t){return Number(e.modifiedOn)<Number(t.modifiedOn)?1:-1}),a.splice(r.cardCacheLimit)),r.setCache(a)}},this.url=t.cardsUrl,this.key=t.localStorage.cards,this.cardCacheLimit=t.cardCacheLimit||0,this.expirationMs=t.cardExpirationMs||0}return t.$inject=["config","$http","$q"],t}();e.CardPriceService=t,angular.module("app").service("cardPriceService",t)}(app||(app={}));var app;!function(e){var t=function(){function e(e,t,n){var i=this;this.$q=t,this.$http=n,this.getDeck=function(e){var t=i.$q.defer(),n=i.$http.get(i.url+"/"+e,{timeout:t}).then(function(e){return e.data});return{cancel:function(){return t.resolve()},promise:n}},this.getDecksByQuery=function(e){var t=i.$q.defer(),n=i.$http.get(i.url,{params:e,timeout:t}).then(function(e){return e.data.results});return{cancel:function(){return t.resolve()},promise:n}},this.createDeck=function(e){return i.$http.post(i.url,e).then(function(e){return e.data.id})},this.updateDeck=function(e){var t=i.url+"/"+e.id;return i.$http.put(t,e)},this.deleteDeck=function(e){var t=i.url+"/"+e;return i.$http["delete"](t)},this.url=e.decksUrl}return e.$inject=["config","$q","$http"],e}();e.DeckService=t,angular.module("app").service("deckService",t)}(app||(app={}));var app;!function(e){var t=function(){function e(){this.restrict="E",this.scope={},this.templateUrl="auth/auth.html"}return e}();angular.module("app").directive("auth",function(){return new t})}(app||(app={}));var app;!function(e){var t=function(){function e(e){var t=this;this.authService=e,this.login=function(){return t.isLoggingIn=!0,t.authService.login()["finally"](function(){t.isLoggingIn=!1})},this.logout=function(){return t.authService.logout()},this.isLoggedIn=function(){return t.authService.isLoggedIn()}}return e.$inject=["authService"],e}();angular.module("app").controller("authController",t)}(app||(app={}));var app;!function(e){var t=function(){function e(){this.restrict="E",this.scope={data:"=",canEdit:"=",isEditing:"@",shouldLoadPrices:"=",cardGroupChanged:"=",cardsChanged:"=",pricesLoaded:"="},this.templateUrl="cardGroup/cardGroup.html"}return e}();angular.module("app").directive("cardGroup",function(){return new t})}(app||(app={}));var app;!function(e){var t=function(){function t(t,n,i){var r=this;this.$scope=t,this.cardDefinitionService=n,this.cardPriceService=i,this.count=0,this.cardGrouper=e.CardGrouper,this.setGroupFunc=function(t){r.showToolbar=!1,r.groupFunc=t,r.showHeaders=r.groupFunc!==e.CardGrouper.groupByName&&r.groupFunc!==e.CardGrouper.groupByPrice,r.onCardViewChanged(),t===e.CardGrouper.groupByPrice&&r.loadPrices()},this.startEditing=function(){r.isEditing=!0,r.showToolbar=!1,r.cardBlob=r.cardGroup.cardBlob},this.applyChanges=function(){r.isEditing&&(r.isEditing=!1,r.cardBlob!==r.cardGroup.cardBlob&&(r.parseCardBlob(),r.cardBlob!==r.cardGroup.cardBlob&&(r.cardGroup.cardBlob=r.cardBlob,r.onCardGroupChanged(),r.onCardsChanged())))},this.discardChanges=function(){r.isEditing&&(r.isEditing=!1)},this.parseCardBlob=function(){if(r.cardBlob=r.cardBlob.trim(),r.cards=[],r.invalidCards=[],0!==r.cardBlob.length){var t={};r.cardBlob.split(/\n[\s\n]*/).forEach(function(e){var n=/^(?:(\d+)[Xx]?\s)?\s*([^0-9]+)$/.exec(e.trim());if(!n)return void r.invalidCards.push(e);var i=r.cardDefinitionService.getCards()[n[2].toLowerCase()];if(!i)return void r.invalidCards.push(e);var a=t[i.name]=t[i.name]||{definition:i,quantity:0,usd:void 0};a.quantity+=Number(n[1])||1}),r.cards=e.Dictionary.toArray(t),r.count=r.cards.reduce(function(e,t){return e+t.quantity},0),r.cardBlob=r.invalidCards.concat(r.cards.sort(function(e,t){return e.definition.name>t.definition.name?1:-1}).map(function(e){return e.quantity+"x "+e.definition.name})).join("\n")}},this.loadPrices=function(){if(!r.isLoadingPrices){var t=r.cards.filter(function(e){return!e.usd}).map(function(e){return e.definition.name});if(0===t.length)return void r.onPricesLoaded();r.isLoadingPrices=!0,r.cardPriceSubscription=r.cardPriceService.getCardPrices(t),r.cardPriceSubscription.promise.then(function(t){var n=e.Dictionary.fromArray(t,function(e){return e.name});r.cards.forEach(function(e){if(void 0===e.usd){var t=n[e.definition.name.toLowerCase()];e.usd=t?Number(t.usd)*e.quantity:null}}),r.usd=r.cards.reduce(function(e,t){return e+t.usd},0),r.isLoadingPrices=!1,r.onPricesLoaded(),r.onPricesChanged()})["finally"](function(){return delete r.cardPriceSubscription})}},this.destroy=function(){r.cardPriceSubscription&&(r.cardPriceSubscription.cancel(),delete r.cardPriceSubscription),r.loadPriceSubscription.unsubscribe()},this.onPricesChanged=function(){r.onCardViewChanged()},this.onPricesLoaded=function(){r.pricesLoaded.broadcast(r.cardGroup)},this.onCardGroupChanged=function(){r.cardGroupChanged.broadcast(r.cardGroup)},this.onCardsChanged=function(){r.cardsChanged.broadcast({cardGroup:r.cardGroup,cards:r.cards}),r.onCardViewChanged()},this.onCardViewChanged=function(){r.cardView=r.groupFunc(r.cards)},this.cardGroup=this.$scope.data,this.cardGroupChanged=this.$scope.cardGroupChanged,this.cardsChanged=this.$scope.cardsChanged,this.pricesLoaded=this.$scope.pricesLoaded,this.isEditing="true"===this.$scope.isEditing,this.$scope.$on("$destroy",this.destroy),this.loadPriceSubscription=this.$scope.shouldLoadPrices.subscribe(this.loadPrices),this.cardBlob=this.cardGroup.cardBlob,this.groupFunc=e.CardGrouper.groupByType,this.showHeaders=!0,this.parseCardBlob(),this.onCardsChanged()}return t.$inject=["$scope","cardDefinitionService","cardPriceService"],t}();angular.module("app").controller("CardGroupController",t)}(app||(app={}));var app;!function(e){var t=function(){function e(){this.restrict="E",this.scope={columns:"=",showHeaders:"="},this.templateUrl="cardView/cardView.html"}return e}();angular.module("app").directive("cardView",function(){return new t})}(app||(app={}));var app;!function(e){var t=function(){function e(){this.restrict="E",this.scope={id:"="},this.templateUrl="deck/deck.html"}return e}();angular.module("app").directive("deck",function(){return new t})}(app||(app={}));var app;!function(e){var t=function(){function t(t,n,i,r,a,c,s){var o=this;this.$location=n,this.$q=i,this.$scope=r,this.config=a,this.authService=c,this.deckService=s,this.cardGroupsThatAreLoadingPrices=[],this.loadPrices=new e.Arbiter,this.cardGroupChanged=new e.Arbiter,this.pricesLoaded=new e.Arbiter,this.cardsChanged=new e.Arbiter,this.togglePrices=function(){o.showPrices=!o.showPrices,o.showPrices&&(o.isLoadingPrices=!0,o.cardGroupsThatAreLoadingPrices=o.deck.cardGroups.slice(),o.loadPrices.broadcast())},this.onTagsChanged=function(){o.deck.tags=o.deck.tags.map(function(e){return e.toLowerCase()}),o.save()},this["delete"]=function(){confirm("Are you sure you want to delete this deck?")&&(o.isDeleting=!0,o.deckService.deleteDeck(o.deck.id).then(function(){return o.$location.path("/decks")})["finally"](function(){return o.isDeleting=!1}))},this.onCardsChanged=function(e){o.showPrices&&o.loadPrices.broadcast(),0===o.deck.cardGroups.indexOf(e.cardGroup)&&(o.statCards=e.cards)},this.onPricesLoaded=function(e){var t=o.cardGroupsThatAreLoadingPrices.indexOf(e);t>-1&&o.cardGroupsThatAreLoadingPrices.splice(t,1),0===o.cardGroupsThatAreLoadingPrices.length&&(o.isLoadingPrices=!1)},this.updateTitle=function(){document.title=o.deck.name},this.sync=function(){var e=o.authService.getAuthUser();!o.deck.id&&e&&(o.deck.owners=[e.id]),o.canWrite=e&&o.deck.owners.indexOf(e.id)>-1,o.canWrite&&o.isDirty&&o.save()},this.save=function(){o.isDirty=!0;var e=o.authService.getAuthUser();if(e)return o.isSaving=!0,o.deck.id?o.updateDeck():o.createDeck()},this.updateDeck=function(){return o.deckService.updateDeck(o.deck).then(function(){return o.isDirty=!1})["finally"](function(){return o.isSaving=!1})},this.createDeck=function(){return o.deckService.createDeck(o.deck).then(function(e){o.deck.id=e,o.isDirty=!1,o.$location.update_path("/decks/"+o.deck.id)})["finally"](function(){return o.isSaving=!1})},this.loadDeck=function(e){return"new"===e?(o.deck=o.newDeck(),o.$q.when(o.deck)):(document.title="Loading",o.deckSubscription=o.deckService.getDeck(e),o.deckSubscription.promise.then(function(e){return o.deck=e})["finally"](function(){return delete o.deckSubscription}))},this.newDeck=function(){var e=JSON.parse(localStorage.getItem(o.config.localStorage.tags)),t=e&&e.current?[e.current]:[];return{cardGroups:[{name:"Mainboard",cardBlob:""},{name:"Sideboard",cardBlob:""}],id:void 0,name:"New Deck",notes:"",owners:[],tags:t}},this.destroy=function(){o.authSubscription.unsubscribe(),o.deckSubscription&&(o.deckSubscription.cancel(),delete o.deckSubscription)},this.isLoading=!0,this.loadDeck(t.id).then(function(){o.sync(),o.updateTitle()})["finally"](function(){return o.isLoading=!1}),this.authSubscription=this.authService.subscribe(this.sync),this.$scope.$on("$destroy",this.destroy),this.pricesLoaded.subscribe(this.onPricesLoaded),this.cardGroupChanged.subscribe(this.save),this.cardsChanged.subscribe(this.onCardsChanged)}return t.$inject=["$routeParams","$location","$q","$scope","config","authService","deckService"],t}();angular.module("app").controller("deckController",t)}(app||(app={}));var app;!function(e){var t=function(){function e(){this.restrict="E",this.templateUrl="decks/decks.html"}return e}();angular.module("app").directive("decks",function(){return new t})}(app||(app={}));var app;!function(e){var t=function(){function t(t,n,i,r){var a=this;this.$scope=t,this.authService=n,this.config=i,this.deckService=r,this.tagOptions=[void 0,null],this.currentTagOptionIndex="0",this.onCurrentTagOptionIndexChanged=function(){a.currentTag=a.tagOptions[a.currentTagOptionIndex],a.onCurrentTagChanged(),a.onTagStateChanged(),a.filterDecks()},this.loadDecks=function(){var e=a.authService.getAuthUser();e&&(a.isLoading=!0,a.decksSubscription=a.deckService.getDecksByQuery({owner:e.id}),a.decksSubscription.promise.then(function(e){a.decks=e.sort(function(e,t){return e.name>t.name?1:-1}),a.onDecksChanged()})["finally"](function(){delete a.decksSubscription,a.isLoading=!1}))},this.onDecksChanged=function(){a.tags=e.Dictionary.toArray(a.decks.reduce(function(e,t){return t.tags.forEach(function(t){e[t]=t}),e},{})).sort(),a.tagOptions=[void 0,null].concat(a.tags);var t=a.tagOptions.indexOf(a.currentTag);t===-1?(a.currentTagOptionIndex="0",delete a.currentTag,a.onCurrentTagChanged()):a.currentTagOptionIndex=t.toString(),a.onTagStateChanged(),a.filterDecks()},this.onTagStateChanged=function(){if(a.authService.getAuthUser()){var e={all:a.tags,current:a.currentTag};localStorage.setItem(a.config.localStorage.tags,JSON.stringify(e))}},this.filterDecks=function(){if(!a.decks||0===a.decks.length)return void delete a.visibleDecks;switch(a.currentTag){case void 0:a.visibleDecks=a.decks;break;case null:a.visibleDecks=a.decks.filter(function(e){return 0===e.tags.length});break;default:a.visibleDecks=a.decks.filter(function(e){return e.tags.indexOf(a.currentTag)>-1})}},this.onCurrentTagChanged=function(){a.currentTagName=void 0===a.currentTag?"All":null===a.currentTag?"Untagged":a.currentTag},this.sync=function(){var e=a.authService.getAuthUser();e?a.decksSubscription||a.decks||a.loadDecks():(delete a.decks,delete a.visibleDecks,delete a.currentTag,a.tags=[],a.onCurrentTagChanged(),a.decksSubscription&&(a.decksSubscription.cancel(),delete a.decksSubscription))},this.destroy=function(){a.authSubscription.unsubscribe(),a.decksSubscription&&(a.decksSubscription.cancel(),delete a.decksSubscription)},this.authSubscription=this.authService.subscribe(this.sync),this.$scope.$on("$destroy",this.destroy),this.sync();var c=JSON.parse(localStorage.getItem(this.config.localStorage.tags));c&&(this.tags=c.all,this.currentTag=c.current,this.tagOptions=[void 0,null].concat(this.tags),this.currentTagOptionIndex=this.tagOptions.indexOf(this.currentTag).toString()),this.onCurrentTagChanged()}return t.$inject=["$scope","authService","config","deckService"],t}();angular.module("app").controller("decksController",t)}(app||(app={}));var app;!function(e){var t=function(){function e(){this.restrict="E",this.scope={},this.templateUrl="notFound/notFound.html";
}return e}();angular.module("app").directive("notFound",function(){return new t})}(app||(app={}));var app;!function(e){var t=function(){function e(){this.restrict="E",this.templateUrl="spinner/spinner.html"}return e}();angular.module("app").directive("spinner",function(){return new t})}(app||(app={}));var app;!function(e){var t=function(){function e(){this.restrict="E",this.scope={cards:"="},this.controller="statsController as vm",this.templateUrl="stats/statsView.html"}return e}();angular.module("app").directive("stats",function(){return new t})}(app||(app={}));var app;!function(e){var t=function(){function t(e,n){var i=this;this.updateStats=function(e){if(!e)return void delete i.stats;var n=new Array(17).fill(0);e.forEach(function(e){void 0!==t.cardTypes[e.definition.primaryType]&&(n[e.definition.cmc]+=e.quantity)});for(var r=n.length-1;r>-1&&0===n[r];--r)n.pop();i.stats=n.map(function(e){return{value:new Array(e).fill("X").join("")}})},e.$watchCollection("cards",this.updateStats)}return t.$inject=["$scope","config"],t.cardTypes=e.Dictionary.fromArray(["creature","artifact","enchantment","planeswalker","instant","sorcery"],function(e){return e}),t}();angular.module("app").controller("statsController",t)}(app||(app={}));