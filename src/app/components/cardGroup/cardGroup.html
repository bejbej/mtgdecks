<div ng-controller="CardGroupController as vm">
    <ul class="nav nav-pills" ng-if="vm.canEdit && !vm.isEditing">
        <li>
            <div ng-click="vm.showToolbar = !vm.showToolbar">
                {{::vm.cardGroup.name}}
                <span class="badge">{{::vm.cardGroup.count}}</span>
                <span class="icon" ng-if="vm.cardGroup.cards.length > 0">{{vm.showToolbar ? "7" : "4"}}</span>
            </div>
        </li>
        <li>
            <a ng-click="vm.startEditing()">Edit</a>
        </li>
    </ul>
    <ul class="nav nav-tabs" ng-if="vm.isEditing">
        <li>
            <a ng-click="vm.applyChanges()">
                {{::vm.cardGroup.name}}
                <span class="badge">{{::vm.cardGroup.count}}</span>
                <span class="icon" ng-if="vm.cardGroup.cards.length > 0">{{::vm.showToolbar ? "7" : "4"}}</span>
            </a>
        </li>
        <li class="active">
            <a>Edit</a>
        </li>
    </ul>
    <header ng-if="!vm.canEdit && vm.cardGroup.cards.length === 0">
        <span>{{::vm.cardGroup.name}}</span>
        <span class="badge">{{::vm.cardGroup.count}}</span>
    </header>
    <header ng-if="!vm.canEdit && vm.cardGroup.cards.length > 0" ng-click="vm.showToolbar = !vm.showToolbar">
        <span>{{::vm.cardGroup.name}}</span>
        <span class="badge">{{::vm.cardGroup.count}}</span>
        <span class="icon" ng-if="vm.cardGroup.cards.length > 0">{{vm.showToolbar ? "7" : "4"}}</span>
    </header>
    <div class="radio-group" ng-if="vm.cardGroup.cards.length > 0 && !vm.isEditing && vm.showToolbar">
        <label>
            <input type="radio" ng-model="vm.view" value="group-by-type" ng-click="vm.showToolbar = false"/>
            Card Type
        </label>
        <label>
            <input type="radio" ng-model="vm.view" value="group-by-color" ng-click="vm.showToolbar = false"/>
            Color
        </label>
        <label>
            <input type="radio" ng-model="vm.view" value="group-by-cmc" ng-click="vm.showToolbar = false"/>
            Converted Mana Cost
        </label>
        <label>
            <input type="radio" ng-model="vm.view" value="group-by-name" ng-click="vm.showToolbar = false"/>
            Name
        </label>
    </div>
    <div class="alert alert-danger margin" ng-if="vm.cardGroup.failedCards.length > 0">
        Couldn't identify the following cards:
        <ul>
            <li ng-repeat="card in vm.cardGroup.failedCards track by $index">{{card}}</li>
        </ul>
    </div>
    <div ng-if="!vm.isEditing && vm.cardGroup.cards.length > 0">
        <directive-container directive="vm.view" cards="vm.cardGroup.cards"></directive-container>
    </div>
    <form name="vm.form" class="margin" ng-if="vm.isEditing">
        <textarea class="form-control has-bottom-buttons"
                  placeholder="4x Island"
                  ng-model="vm.cardsBlob"
                  ng-model-options="{updateOn: 'blur'}"
                  msd-elastic></textarea>
        <div class="bottom-buttons">
            <button class="btn btn-default" type="button" ng-click="vm.applyChanges()">Apply Changes</button><!--
            --><button class="btn btn-default" type="button" ng-click="vm.discardChanges()">Discard Changes</button>
        </div>
    </form>
</div>