<div ng-controller="CardGroupController as vm">
    <header ng-if="!vm.isEditing" ng-click="vm.showToolbar = !vm.showToolbar">
        <span>{{::vm.cardGroup.name}}</span>
        <span ng-if="!vm.isEditing">
            <span class="badge" ng-if="!vm.isEditing">{{vm.cardGroup.count()}}</span>
            <button class="btn btn-default btn-xs" ng-click="vm.startEditing(); $event.stopPropagation();" ng-if="vm.canEdit">Edit</button>
            <span class="glyphicon pull-right" ng-class="{'glyphicon-chevron-up': vm.showToolbar, 'glyphicon-chevron-down': !vm.showToolbar}" ng-if="vm.cardGroup.cards.length > 0"></span>
        </span>
    </header>
    <header ng-if="vm.isEditing">
        <span>{{::vm.cardGroup.name}}</span>
        <button class="btn btn-default btn-xs" ng-click="vm.applyChanges()">Apply Changes</button>
        <button class="btn btn-default btn-xs" ng-click="vm.discardChanges()">Discard Changes</button>
    </header>
    <div class="radio-group" ng-if="vm.cardGroup.cards.length > 0 && !vm.isEditing && vm.showToolbar">
        <label>
            <input type="radio" ng-model="vm.view" value="group-by-type" ng-click="vm.showToolbar = false"/>
            Card Type
        </label>
        <label>
            <input type="radio" ng-model="vm.view" value="group-by-color" ng-click="vm.showToolbar = false"/>
            Color
        </label>
        <label>
            <input type="radio" ng-model="vm.view" value="group-by-cmc" ng-click="vm.showToolbar = false"/>
            Converted Mana Cost
        </label>
    </div>
    <div class="alert alert-danger margin" ng-if="vm.cardGroup.failedCards.length > 0">
        Couldn't identify the following cards:
        <ul>
            <li ng-repeat="card in ::vm.cardGroup.failedCards">{{::card.name}}</li>
        </ul>
    </div>
    <div ng-if="!vm.isEditing && vm.cardGroup.cards.length > 0">
        <directive-container directive="vm.view" cards="vm.cardGroup.cards"></directive-container>
    </div>
    <form name="vm.form" class="margin" ng-if="vm.isEditing">
        <div class="form-group">
            <textarea class="form-control"
                      ng-model="vm.cardsBlob"
                      ng-model-options="{updateOn: 'blur'}"
                      msd-elastic></textarea>
        </div>
        <button class="btn btn-default" type="button" ng-click="vm.applyChanges()">Apply Changes</button>
        <button class="btn btn-default" type="button" ng-click="vm.discardChanges()">Discard Changes</button>
    </form>
</div>